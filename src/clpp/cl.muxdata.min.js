(function(){var g={}; var _ = _ || {};
var f=function(window){var lu="clpp.plugin.mux",mu=function(a,b){this.l=a;this.m=this.g=null;this.A=("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6);this.a=new _.Vg;this.f=b;this.o=this.j=this.h=this.w=!1},ou=function(a){var b={debug:!1,data:nu(a)};a.g&&a.g.muxOptionsOverride&&_.A.Kc(a.g.muxOptionsOverride)&&(b=_.A.Ta(b,a.g.muxOptionsOverride,{getPlayheadTime:function(){return 1E3*a.l.getPosition()},getStateData:function(){a.f.debug("getStateData()");var c=a.l.getLoadedSource(),d=a.l.getTrackManager(),
e=a.l.getSurface(),f=d.fa(),g={player_is_paused:a.l.isPaused(),player_is_fullscreen:e.isFullscreen(),video_source_duration:1E3*a.l.getDuration(),player_autoplay_on:!!a.l.getConfiguration().autoplay};if(c){var k=new _.Pj(c.url);g.video_source_url=_.Qj(k);g.video_source_mime_type=c.type;c.name&&(g.video_title=c.name)}if(c=e.getContainer())g.player_width=c.offsetWidth,g.player_height=c.offsetHeight;f&&f.height&&f.width&&(g.video_source_height=f.height,g.video_source_width=f.width);(d=d.ha())&&d.language&&
(g.player_language_code=d.language);return g}}));a.f.debug("Mux SDK options",b);return b},nu=function(a){var b={env_key:a.g.envKey,video_title:a.m&&a.m.name||"",player_software_name:_.qa,player_software_version:_.da,player_mux_plugin_name:"CastlabsPlayer built-in Mux Plugin",player_mux_plugin_version:_.da};(a=a.l.getConfiguration().viewerId)&&(b.viewer_user_id=a);return b},pu=function(a,b,c){a.f.debug("Event: "+b);mux.emit(a.A,b,c)},qu=function(a){a.a.on(a.l,_.re,function(){pu(a,_.re,{player_playhead_time:1E3*
a.l.getPosition()})});a.a.on(a.l,_.Od,function(){return pu(a,_.Od)});a.a.on(a.l,_.gc,a.$h.bind(a));a.a.on(a.l,_.he,a.bi.bind(a));a.a.on(a.l,_.Ae,function(){return pu(a,_.ce)});a.a.on(a.l,_.ze,function(){return pu(a,_.be)});a.a.on(a.l,_.Zc,a.ai.bind(a));a.a.on(a.l,_.ob,function(){return pu(a,"adbreakstart")});a.a.on(a.l,_.pb,function(){return pu(a,"adbreakend")});a.a.on(a.l,_.Fb,function(){pu(a,"adplay");pu(a,"adplaying")});a.a.on(a.l,_.Ab,function(){return pu(a,"adpause")});a.a.on(a.l,_.Db,function(){pu(a,
"adplay");pu(a,"adplaying")});a.a.on(a.l,_.Hb,function(){return pu(a,"adended")});a.a.on(a.l,_.wb,function(){return pu(a,"adfirstquartile")});a.a.on(a.l,_.zb,function(){return pu(a,"admidpoint")});a.a.on(a.l,_.Ib,function(){return pu(a,"adthirdquartile")})},ru=function(){this.f=null;this.a=!1;this.g=new _.G("clpp.muxdata")},su=function(){};_.h=mu.prototype;_.h.release=function(){this.f.debug("release()");this.j?this.f.debug(_.ma):(_.Yg(this.a),this.j=!0,this.m=this.g=null)};
_.h.destroy=function(){this.f.debug(_.Lc);this.o?this.f.debug(_.la):(this.o=!0,this.h&&this.w&&pu(this,"viewend"),pu(this,"destroy"))};_.h.$h=function(a){this.f.debug(_.Bd);var b=a.detail;a=this.l.getTrackManager();b&&b.bandwidth&&(b=b.bandwidth,(a=a.xa())&&a.bandwidth&&(b+=a.bandwidth),pu(this,"renditionchange",{video_source_bitrate:b}))};
_.h.bi=function(a){this.f.debug(_.Gd);switch(a.detail.currentState){case _.ao:this.l.getConfiguration().autoplay&&pu(this,_.Od);break;case _.Dn:pu(this,_.Pd);break;case _.bo:pu(this,_.Ld);break;case _.Xn:this.w=!0,pu(this,_.Yc)}};
_.h.ai=function(a){this.f.debug(_.Dd);if(this.h&&(a=a.detail||null))if(10003===a.code)pu(this,"aderror");else if(a.a===_.L){var b=a.message||"Player error";if(1===a.h||6100===a.code||6007===a.code)b="Download error",6100===a.code?b="Certificate request error":6007===a.code&&(b="License request error"),b=b+" castlabs-error-data:"+JSON.stringify(a.data);pu(this,_.Zc,{player_error_code:a.code,player_error_message:b})}};_.u(ru,_.xo);_.h=ru.prototype;_.h.onPlayerCreated=function(a){this.f=new mu(a,this.g)};
_.h.onContentWillLoad=function(a,b){var c=a.getConfiguration();if(this.a=!_.A.N(c.muxdata)&&typeof c.muxdata===_.Ad){c=c.muxdata;var d;if(d="undefined"===typeof window.mux)c=c.muxLib,d="undefined"!==typeof c&&typeof c.init===_.ad&&typeof c.emit===_.ad,window.mux=c,d=!d;d&&(this.g.warn("Mux SDK is not loaded. Will do nothing."),this.a=!1,c=new _.K(1,9,9301),a.trigger(new _.M(_.Zc,{detail:c})))}else this.g.warn("Mux plugin is loaded but not configured. Will do nothing.");if(this.a){c=a.getConfiguration();
c=_.A.va(c.muxdata||{});try{d=[];typeof c===_.Ad&&(c.envKey||d.push("envKey"));if(0<d.length)throw new _.K(1,9,9300,{missingKeys:d});var e=this.f;e.g=c;e.m=b;e.w=!1;if(!e.h){try{e.h=!0,mux.init(e.A,ou(e))}catch(f){throw e.h=!1,_.Yg(e.a),new _.K(1,9,9302,null,f);}pu(e,"playerready")}e.j&&!e.o&&(pu(e,"videochange",nu(e)),e.j=!1);qu(e)}catch(f){this.a=!1,a.trigger(new _.M(_.Zc,{detail:f}))}}};_.h.onContentLoaded=function(){};_.h.onPlayerWillDestroy=function(){this.a&&(this.f.destroy(),this.f=null)};
_.h.onPlayerWillRelease=function(){this.a&&this.f.release()};_.h.id=function(){return lu};_.z("clpp.muxdata.MuxDataPlugin",ru);ru.Id=lu;su.prototype.create=function(){return new ru};_.Rn(new su);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.min.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core.min"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();